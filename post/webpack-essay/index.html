
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>Webpack Essay | å››è¾…çš„åšå®¢</title>
<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="shortcut icon" href="https://sfmonkey.github.io//favicon.ico">
<link rel="stylesheet" href="https://sfmonkey.github.io//styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>


  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://sfmonkey.github.io/">
        <img class="avatar" src="https://sfmonkey.github.io//images/avatar.png" alt="" width="32px" height="32px">
      </a>
      <a href="https://sfmonkey.github.io/">
        <h1 class="site-title">å››è¾…çš„åšå®¢</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            å…³äº
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          <h2 class="post-title">Webpack Essay</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2020-03-25</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://sfmonkey.github.io//tag/yldW1tuxF">
                    Essay
                    
                      ï¼Œ
                    
                  </a>
                
                  <a href="https://sfmonkey.github.io//tag/fq56-p2wF">
                    webpack
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <h3 id="æ¦‚è¦">æ¦‚è¦</h3>
<p>webpack æ˜¯å‰ç«¯æœ€å¸¸ç”¨çš„<strong>æ¨¡å—æ‰“åŒ…å·¥å…·</strong>äº†ï¼Œå…³äºå®ƒçš„çŸ¥è¯†ï¼Œæˆ‘ä»¬ä»ä½¿ç”¨å’ŒåŸç†ä¸¤æ–¹é¢æ¥è®¨è®ºä¸‹ã€‚</p>
<ul>
<li>Webpack ä½¿ç”¨
<ul>
<li>åŸºç¡€é…ç½®</li>
<li>webpack ä¼˜åŒ–</li>
</ul>
</li>
<li>Webpack åŸç†
<ul>
<li>Loader å’Œ Plugin çš„åŒºåˆ«</li>
<li>å¦‚ä½•ä¿è¯å„ä¸ª loader æŒ‰ç…§é¢„æƒ³æ–¹å¼å·¥ä½œ</li>
<li>Webpack æ„å»ºæµç¨‹</li>
<li>æ–‡ä»¶ç›‘å¬åŸç†</li>
<li>Webpack çƒ­æ›´æ–°åŸç†</li>
<li>ä»£ç åˆ†å‰²çš„æœ¬è´¨ä¸æ„ä¹‰</li>
<li>Babel åŸç†</li>
</ul>
</li>
<li>Webpack å®ç°
<ul>
<li>å®ç°ä¸€ä¸ªç®€å•çš„ Webpack</li>
<li>å®ç°ä¸€ä¸ªLoader</li>
<li>å®ç°ä¸€ä¸ªPlugin</li>
</ul>
</li>
</ul>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<h4 id="åŸºç¡€é…ç½®">åŸºç¡€é…ç½®</h4>
<ul>
<li>
<p>Loader</p>
<ul>
<li>
<p>JavaScript ç›¸å…³</p>
<ul>
<li>
<p>babel-loader</p>
<p>å°† ES6 + çš„è¯­æ³•è½¬æ¢æˆ ES5</p>
</li>
<li>
<p>ts-loader</p>
<p>å°† Typescript è½¬æ¢æˆ Javascript</p>
</li>
<li>
<p>awesome-typescript-loader</p>
<p>å°† TypeScript è½¬æ¢æˆ JavaScriptï¼Œ æ€§èƒ½ä¼˜äº ts-loader</p>
</li>
<li>
<p>eslint-loader</p>
<p>é€šè¿‡ ESLint æ£€æŸ¥ Javascript ä»£ç </p>
</li>
<li>
<p>tslint-loader</p>
<p>é€šè¿‡ tslint æ£€æŸ¥ TypeScript ä»£ç </p>
</li>
<li>
<p>vue-loader</p>
<p>åŠ è½½ Vuejs å•æ–‡ä»¶ç»„ä»¶</p>
</li>
</ul>
</li>
<li>
<p>CSS ç›¸å…³</p>
<ul>
<li>
<p>sass-loader</p>
<p>å°† SCSS/SASS ä»£ç è½¬æ¢æˆ CSS</p>
</li>
<li>
<p>postcss-loader</p>
<p>æ‰©å±• CSS è¯­æ³•ï¼Œä½¿ç”¨ä¸‹ä¸€ä»£ CSSï¼Œä¾‹å¦‚å¯ä»¥é…åˆ autoprefixer æ’ä»¶è‡ªåŠ¨è¡¥é½ CSS3 å‰ç¼€</p>
</li>
<li>
<p>css-loader</p>
<p>åŠ è½½ CSSï¼Œæ”¯æŒæ¨¡å—åŒ–ï¼Œå‹ç¼©ï¼Œæ–‡ä»¶å¯¼å…¥ç­‰ç‰¹æ€§</p>
</li>
<li>
<p>style-loader</p>
<p>å°† CSS ä»£ç é€šè¿‡ style æ ‡ç­¾çš„æ–¹å¼åŠ è½½è¿› html</p>
</li>
</ul>
</li>
<li>
<p>æ–‡ä»¶ç›¸å…³</p>
<ul>
<li>
<p>file-loader</p>
<p>å°†æ–‡ä»¶è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œåœ¨ä»£ç ä¸­é€šè¿‡ç›¸å¯¹ URL å»å¼•ç”¨è¾“å‡ºçš„æ–‡ä»¶ï¼ˆå¤„ç†å›¾ç‰‡å’Œå­—ä½“ï¼‰</p>
</li>
<li>
<p>url-loader</p>
<p>ä¸ file-loader ç±»ä¼¼ï¼ŒåŒºåˆ«æ˜¯ç”¨æˆ·å¯ä»¥è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå°äºé˜ˆå€¼æ—¶è¿”å›æ–‡ä»¶çš„ base64 å½¢å¼ç¼–ç ï¼ˆå¤„ç†å›¾ç‰‡å’Œå­—ä½“ï¼‰</p>
</li>
<li>
<p>raw-loader</p>
<p>å°†æ–‡ä»¶å†…å®¹é€šè¿‡å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºï¼ˆutf-8ï¼‰</p>
</li>
</ul>
</li>
<li>
<p>ä¼˜åŒ–ç›¸å…³</p>
<ul>
<li>
<p>cache-loader</p>
<p>å¯ä»¥åœ¨ä¸€äº›æ€§èƒ½å¼€é”€è¾ƒå¤§çš„ Loader ä¹‹å‰æ·»åŠ ï¼Œç›®çš„æ˜¯å°†ç»“æœç¼“å­˜åœ¨ç£ç›˜é‡Œ</p>
</li>
<li>
<p>thread-loader</p>
<p>ä¸ cache-loader ä½¿ç”¨æ•ˆæœä¸ä½ç½®ç›¸åŒ</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Plugins</p>
<ul>
<li>
<p>é€šç”¨æ’ä»¶</p>
<ul>
<li>
<p>clean-webpack-plugin</p>
<p>ç›®å½•æ¸…ç†</p>
</li>
<li>
<p>html-webpack-plugin</p>
<p>ç®€åŒ– HTML æ–‡ä»¶åˆ›å»ºï¼ˆå¯ä»¥æŒ‡å®š template ä»¥åŠè‡ªåŠ¨å¼•å…¥å…¥å£æ–‡ä»¶ï¼‰</p>
</li>
<li>
<p>webpack.ProvidePlugin</p>
<p>å®šä¹‰å…¨å±€å˜é‡ï¼Œä¸å¿…åˆ°å¤„ require æˆ– import</p>
</li>
<li>
<p>HappyPack</p>
<p>å¤šè¿›ç¨‹æ‰“åŒ…</p>
</li>
<li>
<p>webpack.DefinePlugin</p>
<p>å®šä¹‰ç¯å¢ƒå˜é‡ï¼ˆåœ¨é¡¹ç›®ä»£ç ä¸­å¯èƒ½å­˜åœ¨éœ€è¦ç¯å¢ƒå˜é‡çš„æƒ…å†µï¼‰</p>
</li>
</ul>
</li>
<li>
<p>å¼€å‘æ’ä»¶</p>
<ul>
<li>
<p>HotModuleReplacementPlugin</p>
<p>webpack çš„çƒ­æ›´æ–°åˆç§°çƒ­æ›¿æ¢ï¼ˆHMRï¼‰ï¼Œè¿™ä¸ªæœºåˆ¶å¯ä»¥åšåˆ°ä¸ç”¨åˆ·æ–°æµè§ˆå™¨è€Œå°†æ–°å˜æ›´çš„æ¨¡å—æ›¿æ¢æ‰æ—§çš„æ¨¡å—</p>
</li>
</ul>
</li>
<li>
<p>ç”Ÿäº§æ’ä»¶</p>
<ul>
<li>
<p>mini-css-extract-plugin</p>
<p>åˆ†ç¦»æ ·å¼æ–‡ä»¶ï¼ŒCSS æå–ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½</p>
</li>
<li>
<p>workbox-webpack-plugin</p>
<p>ä¸ºç½‘é¡µåº”ç”¨å¢åŠ ç¦»çº¿ç¼“å­˜åŠŸèƒ½</p>
</li>
<li>
<p>purifycss-webpack</p>
<p>åˆ©ç”¨è¯¥æ’ä»¶è¿›è¡Œ css treeshaking</p>
</li>
<li>
<p>webpack.DllReferencePlugin</p>
<p>æ ¹æ® DllPlugin ç”Ÿæˆçš„ manifest æ–‡ä»¶ï¼Œå¯¹ bundle æ–‡ä»¶è¿›è¡Œæ˜ å°„</p>
</li>
<li>
<p>add-asset-html-webpack-plugin</p>
<p>å°†æŒ‡å®šçš„é™æ€æ–‡ä»¶å†™å…¥ html</p>
</li>
<li>
<p>webpack-bundle-analyzer</p>
<p>å¯è§†åŒ– webpack è¾“å‡ºæ–‡ä»¶çš„ä½“ç§¯ï¼ˆä¸šåŠ¡ç»„ä»¶ï¼Œç¬¬ä¸‰æ–¹ç»„ä»¶ï¼‰</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å…¶ä»–é…ç½®</p>
<ul>
<li>
<p>æ–‡ä»¶æŒ‡çº¹ï¼šæ–‡ä»¶æŒ‡çº¹æ˜¯æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶åçš„åç¼€ï¼Œä¸€å…±åˆ†ä¸‰ç§</p>
<ul>
<li>
<p>Hash
å’Œæ•´ä¸ªé¡¹ç›®çš„æ„å»ºæœ‰å…³ï¼Œåªè¦é¡¹ç›®æ–‡ä»¶æœ‰ä¿®æ”¹ï¼Œæ•´ä¸ªé¡¹ç›®æ„å»ºçš„hashå€¼å°±ä¼šæ›´æ”¹</p>
<p>è®¾ç½® file-loader çš„nameï¼Œä½¿ç”¨hash</p>
</li>
<li>
<p>Chunkhash
å’Œ webpack æ‰“åŒ…çš„ chunk æœ‰å…³ï¼Œä¸åŒçš„ entry ä¼šç”Ÿå‡ºä¸åŒçš„ chunkhash</p>
<p>è®¾ç½® output çš„ filenameï¼Œ ç”¨ chunkhash</p>
</li>
<li>
<p>Contenthash
æ ¹æ®æ–‡ä»¶å†…å®¹æ¥å®šä¹‰ hashï¼Œæ–‡ä»¶å†…å®¹ä¸å˜ï¼Œåˆ™ contenthash ä¸å˜</p>
<p>è®¾ç½® MiniCssExtractPlugin çš„ filenameï¼Œ ä½¿ç”¨ contenthash</p>
</li>
</ul>
</li>
<li>
<p>optimization</p>
</li>
</ul>
</li>
</ul>
<h4 id="webpack-ä¼˜åŒ–">webpack ä¼˜åŒ–</h4>
<ul>
<li>
<p>æå‡webpackæ„å»ºé€Ÿåº¦</p>
<ul>
<li>
<p>å¤šè¿›ç¨‹/å¤šå®ä¾‹æ„å»º</p>
<p>HappyPack å’Œ thread-loader</p>
</li>
<li>
<p>å¤šè¿›ç¨‹å‹ç¼©ä»£ç </p>
<p>terser-webpack-plugin å¼€å¯ parallel å‚æ•°</p>
</li>
<li>
<p>ç¼©å°æ‰“åŒ…ä½œç”¨åŸŸ</p>
<ul>
<li>exclude/inlcude ï¼ˆç¡®å®š loader è§„åˆ™èŒƒå›´ï¼‰</li>
<li>resolve.modules æŒ‡æ˜ç¬¬ä¸‰æ–¹æ¨¡å—çš„ç»å¯¹è·¯å¾„</li>
<li>resolve.mainFields åªé‡‡ç”¨ main å­—æ®µä½œä¸ºå…¥å£æ–‡ä»¶æè¿°å­—æ®µ</li>
<li>resolve.extensions å°½å¯èƒ½å‡å°‘åç¼€å°è¯•çš„å¯èƒ½æ€§</li>
<li>åˆç†ä½¿ç”¨alias</li>
</ul>
</li>
<li>
<p>DLL</p>
<p>ä½¿ç”¨ DllPlugin è¿›è¡Œåˆ†åŒ…ï¼Œä½¿ç”¨ DllReferencePlugin å¯¹ manifest.json å¼•ç”¨ï¼Œè®©ä¸€äº›åŸºæœ¬ä¸ä¼šæ”¹åŠ¨çš„ä»£ç å…ˆæ‰“åŒ…æˆé™æ€èµ„æºï¼Œé¿å…åå¤ç¼–è¯‘</p>
</li>
<li>
<p>å……åˆ†åˆ©ç”¨ç¼“å­˜æå‡äºŒæ¬¡æ„å»ºé€Ÿåº¦</p>
<ul>
<li>babel-loader å¼€å¯ç¼“å­˜</li>
<li>terser-webpack-plugin å¼€å¯ç¼“å­˜</li>
<li>cache-loader</li>
</ul>
</li>
</ul>
</li>
<li>
<p>æå‡é¡µé¢åŠ è½½é€Ÿåº¦</p>
<ul>
<li>åŠ¨æ€ Polyfill
<ul>
<li></li>
</ul>
</li>
<li>Scope hoisting
<ul>
<li>æ„å»ºåçš„ä»£ç ä¼šå­˜åœ¨å¤§é‡é—­åŒ…ï¼Œé€ æˆä½“ç§¯å¢å¤§ï¼Œè¿è¡Œä»£ç æ—¶åˆ›å»ºçš„å‡½æ•°ä½œç”¨åŸŸå˜å¤šï¼Œå†…å­˜å¼€é”€å˜å¤§ã€‚Scope hoisting å°†æ‰€æœ‰æ¨¡å—çš„ä»£ç æŒ‰ç…§å¼•ç”¨é¡ºåºæ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œï¼Œç„¶åé€‚å½“çš„é‡å‘½åä¸€äº›å˜é‡ä»¥é˜²æ­¢å˜é‡åå†²çªã€‚<pre><code class="language-js">//å¼€å¯å‰
[
		/* 0 */
		function(module, exports, require) {
				var module_a = require(1)
				console.log(module_a['default'])
		}

		/* 1 */
		function(module, exports, require) {
				exports['default'] = 'module A'
		}
]

//å¼€å¯å,é€šè¿‡å‡å°‘é—­åŒ…å’Œå‡½æ•°å£°æ˜ï¼Œæ¥å‡å°‘ä»£ç ä½“ç§¯å’Œå†…å­˜å¼€é”€
[
		function(module, exports, require) {
				var module_a_defaultExport = 'module A'
				console.log(module_a_defaultExport)
		}
]
</code></pre>
</li>
<li>å¿…é¡»æ˜¯ ES6 çš„è¯­æ³•ï¼Œå› ä¸ºæœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹åº“ä»é‡‡ç”¨ CommonJs è¯­æ³•ï¼Œä¸ºäº†å……åˆ†å‘æŒ¥ Scope hoisting çš„ä½œç”¨ï¼Œéœ€è¦é…ç½® mainFields å¯¹ç¬¬ä¸‰æ–¹æ¨¡å—ä¼˜å…ˆé‡‡ç”¨ main æŒ‡å‘ ES6 æ¨¡å—åŒ–è¯­æ³•</li>
</ul>
</li>
<li>Tree shaking
<ul>
<li>æ‰“åŒ…è¿‡ç¨‹ä¸­æ£€æµ‹å·¥ç¨‹ä¸­æ²¡æœ‰å¼•å…¥è¿‡çš„æ¨¡å—è¿›è¡Œæ ‡è®°ï¼Œåœ¨èµ„æºå‹ç¼©æ—¶å°†å®ƒä»¬ä»æœ€ç»ˆçš„ bundle ä¸­å»æ‰ï¼ˆ<a href="https://juejin.im/post/5a5652d8f265da3e497ff3de">åªèƒ½å¯¹ ES6 module ç”Ÿæ•ˆ</a>ï¼‰ï¼Œå¼€å‘ä¸­å°½å¯èƒ½ä½¿ç”¨ ES6 module çš„æ¨¡å—ï¼Œæé«˜ tree shaking æ•ˆç‡ã€‚</li>
<li>ç¦ç”¨ babel-loader çš„æ¨¡å—ä¾èµ–è§£æï¼Œå¦åˆ™ webpack æ¥æ”¶åˆ°çš„å°±éƒ½æ˜¯è½¬æ¢è¿‡çš„ CommonJS å½¢å¼çš„æ¨¡å—ï¼Œæ— æ³•è¿›è¡Œ tree-shaking</li>
<li>ä½¿ç”¨ PurifyCSSï¼ˆä¸å†ç»´æŠ¤ï¼‰æˆ–è€… uncss å»é™¤æ— ç”¨ css ä»£ç </li>
</ul>
</li>
<li>æå–é¡µé¢å…¬å…±èµ„æº
<ul>
<li>å°†åŸºç¡€åŒ…é€šè¿‡ externals æˆ–è€… dll æ–¹å¼ CDN å¼•å…¥ï¼Œä¸æ‰“å…¥ bundle ä¸­</li>
<li>ä½¿ç”¨ SplitChunksPlugin è¿›è¡Œä»£ç åˆ†å‰²</li>
</ul>
</li>
<li>å›¾ç‰‡å‹ç¼©ï¼Œé…ç½® image-webpack-loader</li>
<li>æå– CSS æ–‡ä»¶ï¼Œé€šè¿‡css-loaderçš„ minimize é€‰é¡¹å¼€å¯ cssnano å‹ç¼© CSS</li>
</ul>
</li>
</ul>
<h3 id="webpack-åŸç†">webpack åŸç†</h3>
<ul>
<li>
<p>Loader å’Œ Plugin çš„åŒºåˆ«</p>
<p><strong>Loader æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°</strong>ï¼Œåœ¨è¯¥å‡½æ•°ä¸­å¯¹æ¥æ”¶åˆ°çš„å†…å®¹è¿›è¡Œè½¬æ¢ï¼Œè¿”å›è½¬æ¢åçš„ç»“æœã€‚å› ä¸º webpack åªè®¤è¯† JavaScriptï¼Œæ‰€ä»¥ Loader å°±æˆäº†ç¿»è¯‘å®˜ï¼Œå¯¹å…¶ä»–ç±»å‹çš„èµ„æºè¿›è¡Œè½¬è¯‘çš„é¢„å¤„ç†å·¥ä½œã€‚</p>
<p><strong>Plugin å°±æ˜¯æ’ä»¶ï¼Œæ’ä»¶å¯ä»¥æ‰©å±• webpack çš„åŠŸèƒ½</strong>ï¼Œåœ¨ webpack è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¹¿æ’­å‡ºè®¸å¤šäº‹ä»¶ï¼ŒPlugin å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºé€šè¿‡ webpack æä¾›çš„ API æ”¹å˜è¾“å‡ºç»“æœã€‚</p>
<p><strong>Loader</strong> åœ¨ module.rules ä¸­é…ç½®ï¼Œä½œä¸ºæ¨¡å—çš„è§£æè§„åˆ™ï¼Œç±»å‹ä¸ºæ•°ç»„ã€‚æ¯é¡¹éƒ½æ˜¯ä¸€ä¸ª Objectï¼Œ å†…éƒ¨åŒ…å«äº† testï¼Œloaderï¼Œoptions ç­‰å±æ€§ã€‚</p>
<p><strong>Plugin</strong> åœ¨ plugins ä¸­å•ç‹¬é…ç½®ï¼Œç±»å‹ä¸ºæ•°ç»„ï¼Œæ¯ä¸€é¡¹æ˜¯ä¸€ä¸ª Plugin çš„å®ä¾‹ï¼Œå‚æ•°éƒ½é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥ã€‚</p>
</li>
<li>
<p>å¦‚ä½•ä¿è¯å„ä¸ª loader æŒ‰ç…§é¢„æƒ³æ–¹å¼å·¥ä½œ</p>
<p>rules ä¸­çš„æ¯ä¸ª Object éƒ½å¯ä»¥é…ç½®ä¸€ä¸ªkey <strong>enforce</strong>ï¼Œvalue ä¸€èˆ¬æœ‰ä¸¤ä¸ª <strong>pre</strong> <strong>post</strong>ï¼Œpre ä»£è¡¨åœ¨æ‰€æœ‰æ­£å¸¸ loader ä¹‹å‰æ‰§è¡Œï¼Œpost åœ¨æ‰€æœ‰ loader ä¹‹åæ‰§è¡Œã€‚</p>
</li>
<li>
<p>Webpack æ„å»ºæµç¨‹</p>
<p>webpack çš„è¿è¡Œæµç¨‹æ˜¯ä¸€ä¸ªä¸²è¡Œçš„è¿‡ç¨‹ï¼Œä»å¯åŠ¨åˆ°ç»“æŸä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æµç¨‹ï¼š</p>
<ul>
<li>
<p>è¯»å– webpack é…ç½®</p>
<ul>
<li>ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å‚æ•°</li>
</ul>
</li>
<li>
<p>åˆ†æå…¥å£æ–‡ä»¶</p>
<ul>
<li>åˆ†æä¾èµ–æ¨¡å—</li>
<li>åˆ†æå…¥å£æ–‡ä»¶å†…å®¹</li>
<li>ç¼–è¯‘å†…å®¹</li>
</ul>
</li>
<li>
<p>ä¾èµ–æ¨¡å—</p>
<ul>
<li>åˆ†æä¾èµ–æ¨¡å—</li>
<li>åˆ†ææœ¬æ–‡ä»¶å†…å®¹</li>
<li>ç¼–è¯‘å†…å®¹</li>
</ul>
</li>
<li>
<p>ç”Ÿæˆ bundlejs</p>
</li>
</ul>
</li>
<li>
<p>æ–‡ä»¶ç›‘å¬åŸç†</p>
<p>æ–‡ä»¶ç›‘å¬æ˜¯æŒ‡ <strong>webpack --watch</strong>  æˆ–è€… config ä¸­é…ç½® <strong>watch å±æ€§ä¸º true</strong></p>
<p>ç¼ºç‚¹ï¼š æ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨æ›´æ–°æµè§ˆå™¨</p>
<p>åŸç†ï¼š è½®è¯¢åˆ¤æ–­æ–‡ä»¶çš„æœ€åç¼–è¾‘æ—¶é—´æ˜¯å¦å˜åŒ–ï¼Œå¦‚æœæŸä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸ä¼šç«‹åˆ»å‘Šè¯‰ç›‘å¬è€…ï¼Œè€Œæ˜¯å…ˆç¼“å­˜èµ·æ¥ï¼Œç­‰ <strong>aggregateTimeout</strong> åå†æ‰§è¡Œã€‚</p>
<pre><code class="language-js">module.export = {    
	// é»˜è®¤false,ä¹Ÿå°±æ˜¯ä¸å¼€å¯    
	watch: true,    
	// åªæœ‰å¼€å¯ç›‘å¬æ¨¡å¼æ—¶ï¼ŒwatchOptionsæ‰æœ‰æ„ä¹‰    
	watchOptions: {        
	// é»˜è®¤ä¸ºç©ºï¼Œä¸ç›‘å¬çš„æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹ï¼Œæ”¯æŒæ­£åˆ™åŒ¹é…       
	ignored: /node_modules/,        
	// ç›‘å¬åˆ°å˜åŒ–å‘ç”Ÿåä¼šç­‰300mså†å»æ‰§è¡Œï¼Œé»˜è®¤300ms        
	aggregateTimeout:300,        
	// åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å‘ç”Ÿå˜åŒ–æ˜¯é€šè¿‡ä¸åœè¯¢é—®ç³»ç»ŸæŒ‡å®šæ–‡ä»¶æœ‰æ²¡æœ‰å˜åŒ–å®ç°çš„ï¼Œé»˜è®¤æ¯ç§’é—®1000æ¬¡        
	poll:1000    
}}
</code></pre>
</li>
<li>
<p>Webpack çƒ­æ›´æ–°åŸç†</p>
<p>HMR å¯ä»¥åšåˆ°åœ¨ä¸åˆ·æ–°æµè§ˆå™¨çš„æƒ…å†µä¸‹ç”¨æ–°å˜æ›´çš„æ¨¡å—æ›¿æ¢æ‰æ—§çš„æ¨¡å—</p>
<p>HMR çš„æ ¸å¿ƒå°±æ˜¯å®¢æˆ·ç«¯ä»æœåŠ¡å™¨æ‹‰å–æ›´æ–°åçš„æ–‡ä»¶ï¼Œå‡†ç¡®çš„è¯´æ˜¯ chunk diffï¼ˆchunk éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼‰ï¼Œ<strong>å®é™…ä¸Š WDS ä¸æµè§ˆå™¨ä¹‹é—´ç»´æŠ¤äº†ä¸€ä¸ª Websocketï¼Œå½“æœ¬åœ°èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼ŒWDS ä¼šå‘æµè§ˆå™¨å‘é€æ›´æ–°é€šçŸ¥</strong>ï¼Œå¹¶å¸¦ä¸Šæ„å»ºæ—¶çš„ hashï¼Œè®©å®¢æˆ·ç«¯ä¸ä¸Šä¸€æ¬¡èµ„æºè¿›è¡Œå¯¹æ¯”ã€‚<strong>å®¢æˆ·ç«¯å¯¹æ¯”å‡ºå·®å¼‚åä¼šå‘ WDS å‘é€ Ajax è¯·æ±‚æ¥è·å–æ›´æ”¹å†…å®¹</strong>ï¼ˆæ–‡ä»¶åˆ—è¡¨ï¼Œhashï¼‰ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥å†å€ŸåŠ©è¿™äº›ä¿¡æ¯ç»§ç»­å‘ WDS å‘é€ jsonp è¯·æ±‚è·å–è¯¥ chunk çš„å¢é‡æ›´æ–°ã€‚<strong>å®¢æˆ·ç«¯æ‹¿åˆ°å¢é‡æ›´æ–°åï¼Œç”± HotMoudlePlugin æä¾›ç›¸å…³ API ä»¥ä¾›å¼€å‘è€…é’ˆå¯¹è‡ªèº«åœºæ™¯è¿›è¡Œå¤„ç†</strong>ï¼Œreact-hot-loader å’Œ vue-loader éƒ½æ˜¯å€ŸåŠ©è¿™äº› API å®ç°çš„ HMR</p>
<blockquote>
<p>WDS-&gt;websocket-&gt;å®¢æˆ·ç«¯-&gt;Ajax-&gt;æ›´æ–°å†…å®¹-&gt;HotMoudlePlugin-&gt;react-hot-loader/vue-loader-&gt;HMR</p>
</blockquote>
<ul>
<li>ä»£ç åˆ†å‰²çš„æœ¬è´¨ä¸æ„ä¹‰</li>
</ul>
<p>ä»£ç åˆ†å‰²æœ¬è´¨å…¶å®å°±æ˜¯åœ¨ <strong>æºä»£ç ç›´æ¥ä¸Šçº¿</strong> å’Œ <strong>æ‰“åŒ…æˆå”¯ä¸€è„šæœ¬</strong> è¿™ä¸¤ç§æç«¯æ–¹æ¡ˆä¹‹é—´çš„ä¸€ç§æ›´é€‚åˆå®é™…åœºæ™¯çš„ä¸­é—´çŠ¶æ€ã€‚</p>
</li>
<li>
<p>Babel åŸç†</p>
<ul>
<li>è§£æï¼šå°†ä»£ç è½¬æ¢æˆ AST
<ul>
<li>è¯æ³•åˆ†æï¼šå°†ä»£ç å­—ç¬¦ä¸²åˆ†å‰²ä¸º token æµï¼Œå³è¯­æ³•å•å…ƒç»„æˆçš„æ•°ç»„</li>
<li>è¯­æ³•åˆ†æï¼šåˆ†æ token æµï¼ˆä¸Šé¢ç”Ÿæˆçš„æ•°ç»„ï¼‰å¹¶ç”Ÿæˆ AST</li>
</ul>
</li>
<li>è½¬æ¢ï¼šè®¿é—® AST çš„èŠ‚ç‚¹è¿›è¡Œå˜æ¢æ“ä½œç”Ÿäº§æ–°çš„ AST</li>
<li>ç”Ÿæˆï¼šä»¥æ–°çš„ AST ä¸ºåŸºç¡€ç”Ÿæˆä»£ç </li>
</ul>
</li>
</ul>
<h3 id="webpack-å®ç°">Webpack å®ç°</h3>
<h4 id="å®ç°ä¸€ä¸ªç®€å•çš„-webpack">å®ç°ä¸€ä¸ªç®€å•çš„ Webpack</h4>
<p>åŸç†ï¼š</p>
<ol>
<li>è¯»å– webpack é…ç½®</li>
<li>åˆ†æå…¥å£æ¨¡å—
<ul>
<li>è·å–å…¥å£ä¾èµ–</li>
<li>è·å–å…¥å£å†…å®¹</li>
<li>è½¬è¯‘å…¥å£å†…å®¹</li>
</ul>
</li>
<li>åˆ†æä¾èµ–æ¨¡å—
<ul>
<li>è·å–æ¨¡å—ä¾èµ–</li>
<li>è·å–æ¨¡å—å†…å®¹</li>
<li>è½¬è¯‘æ¨¡å—å†…å®¹</li>
</ul>
</li>
<li>å¾—åˆ° bundle.js</li>
</ol>
<p>å®ç°ï¼š</p>
<pre><code class="language-js">const path = require('path');
const fs = require('fs');
const babel = require('@babel/core');
const parser = require('@babel/parser');
const traverse = require('@babel/traverse').default;


class compiler {
    constructor(opt) {
        this.opt = opt;
    }

    run() {
        const {entry, output} = this.opt;

        const res = this.generateCode(entry);

        fs.writeFileSync(path.resolve(output.path, output.filename), res);
    }

    moduleAnalyze(filename) {
        const content = fs.readFileSync(filename, 'utf-8');
        // åˆ†æå†…å®¹
        const ast = parser.parse(content, {
            sourceType: &quot;module&quot;
        });

        const dependencies = {};
        // åˆ†æä¾èµ–æ¨¡å—è·¯å¾„
        traverse(ast, {
            ImportDeclaration({node}){
                const dirname = path.dirname(filename);
                const genFile = './' + path.join(dirname, node.source.value);
                dependencies[node.source.value] = genFile;
            }
        });
        // ç¼–è¯‘å†…å®¹
        const {code} = babel.transformFromAst(ast, null, {
            presets: ['@babel/preset-env']
        });

        return {
            filename,
            dependencies,
            code
        }
    }

    graphAnalyze(entry) {
        // åˆ†æå…¥å£æ¨¡å—
        const entryModule = this.moduleAnalyze(entry);
        const graphArr = [entryModule];

        // åˆ†æä¾èµ–æ¨¡å—
        graphArr.forEach(v =&gt; {
            const {dependencies} = v;

            if (dependencies) {
                for(let key in dependencies) {
                    graphArr.push(this.moduleAnalyze(dependencies[key]));
                }
            }
        });
        
        const graph = {};

        graphArr.forEach(v =&gt; {
            graph[v.filename] = {
                dependencies: v.dependencies,
                code: v.code
            }
        });

        return graph;
    }

    // ç”Ÿæˆç»“æœä»£ç 
    generateCode(entry) {
        // å¾—åˆ°æ‰€æœ‰æ¨¡å—å›¾è°±
        const graph = JSON.stringify(this.graphAnalyze(entry));
        // è¾“å‡º bundle.js
        return `(function(graph){
            // æµè§ˆå™¨æ²¡æœ‰ require ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª
            function require(module) {
                function localRequire(relativePath) {
                    return require(graph[module].dependencies[relativePath]);
                }

                var exports = {};
                (function(require, exports, code){
                    eval(code);
                })(localRequire, exports, graph[module].code);

                return exports;
            }

            require('${entry}')
        })(${graph})`;
    }
}

module.exports = compiler;
</code></pre>
<h4 id="å®ç°ä¸€ä¸ªloader">å®ç°ä¸€ä¸ªLoader</h4>
<pre><code class="language-js">const chalk = require('chalk');

module.exports = function(content) {
    const warning = chalk.keyword('orange');
    const { notice } = this.query;
    let words = ['todo', 'fixme', 'review'];

    if (notice &amp;&amp; Array.isArray(notice) &amp;&amp; notice.length &gt; 0) {
        words = notice;
    }

    const reg = new RegExp(`(\/\/\\s*(${words.join(&quot;|&quot;)}).*$)|(\/\\*[\\s\\S]*(${words.join(&quot;|&quot;)})[\\s\\S]*\\*\/)`, &quot;igm&quot;);
    const res = content.match(reg)

    if (res &amp;&amp; res.length &gt; 0) {
        const len = res.length;

        this.emitWarning(warning(`

           
        â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
        â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•
        â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  
        â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  
        â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
        â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•    â•šâ•â•   â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•
                                               
   
                                        
        There are ${len} ${len &gt; 1 ? 'comments' : 'comment'} you might to notice in ${chalk.green(this.resourcePath)}
        
        `));
    }

    return content;
}
</code></pre>
<h4 id="å®ç°ä¸€ä¸ªplugin">å®ç°ä¸€ä¸ªPlugin</h4>
<ul>
<li>ä¸€ä¸ªJavaScriptç±»å‡½æ•°</li>
<li>åœ¨å‡½æ•°åŸå‹ (prototype)ä¸­å®šä¹‰ä¸€ä¸ªæ³¨å…¥compilerå¯¹è±¡çš„applyæ–¹æ³•</li>
<li>applyå‡½æ•°ä¸­é€šè¿‡compileræ’å…¥æŒ‡å®šçš„äº‹ä»¶é’©å­,åœ¨é’©å­å›è°ƒä¸­æ‹¿åˆ°compilationå¯¹è±¡</li>
<li>ä½¿ç”¨compilationæ“çºµä¿®æ”¹webapackå†…éƒ¨å®ä¾‹æ•°æ®</li>
<li>å¼‚æ­¥æ’ä»¶ï¼Œæ•°æ®å¤„ç†å®Œåä½¿ç”¨callbackå›è°ƒ</li>
</ul>
<p><strong>Compiler å’Œ Compilation çš„åŒºåˆ«åœ¨äºï¼šCompiler ä»£è¡¨äº†æ•´ä¸ª Webpack ä»å¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation åªæ˜¯ä»£è¡¨äº†ä¸€æ¬¡æ–°çš„ç¼–è¯‘</strong></p>
<pre><code class="language-js">class EndPlugin {
    constructor(options) {
        const {doneCb, failCb} = options;

        this.doneCallback = doneCb;
        this.failCallback = failCb;
    }

    apply(compiler) {
        compiler.plugin('done', stats =&gt; {
            this.doneCallback &amp;&amp; this.doneCallback(stats);
        });

        compiler.plugin('failed', error =&gt; {
            this.failCallback &amp;&amp; this.failCallback(error);
        });
    }
}

module.exports = EndPlugin;
</code></pre>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://juejin.im/post/5e6f4b4e6fb9a07cd443d4a5#heading-16">ã€Œåè¡€æ•´ç†ã€å†æ¥ä¸€æ‰“Webpacké¢è¯•é¢˜ğŸ”¥(æŒç»­æ›´æ–°)</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/35407642">Webpack 4è¿›é˜¶--ä»å‰çš„æ—¥è‰²å˜å¾—æ…¢ ï¼Œä¸€ä¸‹åˆåªå¤Ÿæ‰“ä¸€æ¬¡åŒ…</a></li>
</ul>

          </div>
        </div>

        
          <div class="next-post">
            <a class="purple-link" href="https://sfmonkey.github.io//post/react-fiber-essay">
              <h3 class="post-title">
                ä¸‹ä¸€ç¯‡ï¼šReact Fiber Essay
              </h3>
            </a>
          </div>
          
      </div>

      

      <div class="site-footer">
  <div class="slogan">æ¸©æ•…è€ŒçŸ¥æ–°</div>
  Powered by Hve Notes
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
